# ν”„λ΅μ νΈ μ§„ν–‰ μƒν™© λ° ν• μΌ λ©λ΅

## μ „μ²΄ ν”„λ΅μ νΈ μ§„ν–‰λ¥ 

### π“ λ‹¨κ³„λ³„ μ§„ν–‰ μƒν™©
- **1λ‹¨κ³„: κΈ°μ΄κµ¬μ¶•** β… 100% μ™„λ£
- **2λ‹¨κ³„: μΈμ¦ μ‹μ¤ν…** β… 100% μ™„λ£
- **3λ‹¨κ³„: Graph API μ—°λ™** β³ 0% (λ€κΈ°)
- **4λ‹¨κ³„: REST API μ„λ²„** β³ 0% (λ€κΈ°)
- **5λ‹¨κ³„: κ³ κΈ‰ κΈ°λ¥** β³ 0% (λ€κΈ°)

**μ „μ²΄ μ§„ν–‰λ¥ **: 40% (2/5 λ‹¨κ³„ μ™„λ£)

## ν„μ¬ μƒνƒ μ”μ•½

### β… μ™„λ£λ μ‘μ—… (1-2λ‹¨κ³„)

#### 1λ‹¨κ³„: κΈ°μ΄κµ¬μ¶• (μ™„λ£)
1. **ν”„λ΅μ νΈ κµ¬μ΅° μ„¤κ³„**
   - ν΄λ¦° μ•„ν‚¤ν…μ² κΈ°λ° ν΄λ” κµ¬μ΅°
   - ν¬νΈ/μ–΄λ‘ν„° ν¨ν„΄ μ μ©
   - μμ΅΄μ„± μ£Όμ… κµ¬μ΅°

2. **λ„λ©”μΈ λ¨λΈ κµ¬ν„**
   - Account, AuthCodeConfig, DeviceCodeConfig μ—”ν‹°ν‹°
   - Repository ν¬νΈ μΈν„°νμ΄μ¤ μ •μ
   - λΉ„μ¦λ‹μ¤ λ΅μ§ λ¶„λ¦¬

3. **λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„**
   - SQLAlchemy 2.0 λΉ„λ™κΈ° λ¨λΈ
   - κ³„μ • λ° μΈμ¦ μ„¤μ • ν…μ΄λΈ”
   - κ΄€κ³„ν• λ°μ΄ν„° λ¨λΈλ§

4. **κ³„μ • κ΄€λ¦¬ μ μ¦μΌ€μ΄μ¤**
   - κ³„μ • λ“±λ΅ (register_account)
   - κ³„μ • μ΅°ν (get_accounts, get_account_by_*)
   - κ³„μ • μ—…λ°μ΄νΈ (update_account)
   - κ³„μ • μ‚­μ  (delete_account)

5. **CLI μΈν„°νμ΄μ¤**
   - Typer κΈ°λ° λ…λ Ήμ–΄ κµ¬μ΅°
   - Rich λΌμ΄λΈλ¬λ¦¬ μ‹κ°μ  μ¶λ ¥
   - μ—λ¬ μ²λ¦¬ λ° μ‚¬μ©μ ν”Όλ“λ°±

#### 2λ‹¨κ³„: OAuth 2.0 μΈμ¦ μ‹μ¤ν… (μ™„λ£ - 2025-05-26)
1. **μ™„μ „ν• OAuth 2.0 μΈμ¦ κµ¬ν„**
   - β… Authorization Code Flow μ™„μ „ κµ¬ν„
   - β… Device Code Flow μ™„μ „ κµ¬ν„
   - β… μ›Ή μΈν„°νμ΄μ¤ μ½λ°± μ²λ¦¬ (FastAPI)
   - β… ν† ν° κµν™ λ° μ €μ¥

2. **ν† ν° κ΄€λ¦¬ μ‹μ¤ν…**
   - β… μ•΅μ„Έμ¤/λ¦¬ν”„λ μ‹ ν† ν° λ¶„λ¦¬ κ΄€λ¦¬
   - β… ν† ν° μ•”νΈν™” μ €μ¥ (Fernet)
   - β… μλ™/μλ™ ν† ν° κ°±μ‹ 
   - β… ν† ν° μƒνƒ μ΅°ν λ° κ²€μ¦
   - β… JWT νμ‹± λ° λ¬΄κ²°μ„± κ²€μ¦

3. **μ‹κ°„ μ²λ¦¬ κ°μ„ **
   - β… λ¨λ“  μ‹κ°„μ„ μ„μΈ μ‹κ°„(KST, UTC+9)μΌλ΅ ν†µμΌ
   - β… JWT μ‹κ°„κ³Ό DB μ‹κ°„ μ •ν™•ν μΌμΉ
   - β… μ‚¬μ©μ μΉν™”μ μΈ μ‹κ°„ ν‘μ‹

4. **CLI μΈμ¦ λ…λ Ήμ–΄**
   - β… `auth start-auth-code` - Authorization Code Flow μ‹μ‘
   - β… `auth complete-auth-code` - μΈμ¦ μ½”λ“ μ™„λ£
   - β… `auth start-device-code` - Device Code Flow μ‹μ‘
   - β… `auth poll-device-code` - Device Code ν΄λ§
   - β… `auth refresh-token` - ν† ν° κ°±μ‹ 
   - β… `auth revoke-token` - ν† ν° νκΈ°
   - β… `auth token-status` - ν† ν° μƒνƒ ν™•μΈ
   - β… `auth validate-token` - ν† ν° λ¬΄κ²°μ„± κ²€μ¦
   - β… `auth log-raw-token` - ν† ν° μ›λ³Έ κ°’ λ΅κ·Έ μ¶λ ¥
   - β… `auth get-profile` - μ‚¬μ©μ ν”„λ΅ν•„ μ΅°ν
   - β… `auth check-tokens` - λ§λ£ μ„λ°• ν† ν° μλ™ κ°±μ‹ 

5. **μ›Ή μΈν„°νμ΄μ¤**
   - β… FastAPI κΈ°λ° μ›Ή μ„λ²„ (`web_server.py`)
   - β… OAuth μ½λ°± μ²λ¦¬ (`/auth/callback`)
   - β… μΈμ¦ μ‹μ‘ μ—”λ“ν¬μΈνΈ (`/auth/start`)
   - β… HTML μ‘λ‹µ λ° μ‚¬μ©μ μ•λ‚΄

6. **λ³΄μ• λ° μ•”νΈν™”**
   - β… λ¨λ“  ν† ν° Fernet μ•”νΈν™” μ €μ¥
   - β… ν™κ²½λ³€μ κΈ°λ° λ³΄μ• μ„¤μ •
   - β… ν† ν° λ¬΄κ²°μ„± κ²€μ¦ μ‹μ¤ν…

### π”„ μµκ·Ό μ™„λ£λ μ£Όμ” κ°μ„ μ‚¬ν•­ (2025-05-26)

#### JWT μ‹κ°„ μ²λ¦¬ μ •ν™•μ„± κ°μ„ 
- **λ¬Έμ **: JWT ν† ν°μ λ§λ£ μ‹κ°„κ³Ό DB μ €μ¥ μ‹κ°„ λ¶μΌμΉ
- **ν•΄κ²°**: `datetime.utcfromtimestamp()` β†’ `datetime.fromtimestamp(exp, tz=timezone.utc)` λ³€κ²½
- **κ²°κ³Ό**: JWTμ™€ DB μ‹κ°„ μ°¨μ΄ 1μ΄ λ―Έλ§μΌλ΅ μ •ν™•ν μΌμΉ

#### λ°μ΄ν„°λ² μ΄μ¤ μ‹κ°„ ν•„λ“ μ„μΈ μ‹κ°„ μ μ©
- **λ¬Έμ **: μƒλ΅ μΈμ¦λ°›μ•„λ„ μƒμ„± μ‹κ°„μ΄ UTCλ΅ μ €μ¥
- **ν•΄κ²°**: SQLAlchemy λ¨λΈμ—μ„ `server_default=func.now()` β†’ `default=now_kst` λ³€κ²½
- **κ²°κ³Ό**: λ¨λ“  μƒ ν† ν°μ΄ μ„μΈ μ‹κ°„μΌλ΅ μ €μ¥

#### CLI μ¶λ ¥ κ°μ„ 
- **λ¬Έμ **: Authorization Code Flow μ¶λ ¥μ— λ¶ν•„μ”ν• λ°•μ¤
- **ν•΄κ²°**: λ°•μ¤ μ κ±°ν•κ³  κΉ”λ”ν• ν…μ¤νΈ μ¶λ ¥μΌλ΅ λ³€κ²½
- **κ²°κ³Ό**: μ‚¬μ©μ μΉν™”μ μΈ CLI μΈν„°νμ΄μ¤

### π“ μ„±λ¥ λ° ν’μ§ μ§€ν‘ λ‹¬μ„± ν„ν™©

#### κΈ°λ¥μ  μ”κµ¬μ‚¬ν•­ (100% λ‹¬μ„±)
- β… Authorization Code Flowλ΅ μ„±κ³µμ μΈ μΈμ¦
- β… Device Code Flowλ΅ μ„±κ³µμ μΈ μΈμ¦
- β… ν† ν° μλ™ κ°±μ‹  κΈ°λ¥ μ‘λ™
- β… μΈμ¦ μƒνƒ μ •ν™•ν• ν‘μ‹
- β… λ΅κ·Έμ•„μ›ƒ μ‹ ν† ν° μ™„μ „ μ‚­μ 

#### λΉ„κΈ°λ¥μ  μ”κµ¬μ‚¬ν•­ (100% λ‹¬μ„±)
- β… μΈμ¦ κ³Όμ • 30μ΄ μ΄λ‚΄ μ™„λ£
- β… ν† ν° μ•”νΈν™” μ €μ¥ ν™•μΈ
- β… CLI λ…λ Ήμ–΄ μ§κ΄€μ  μ‚¬μ©
- β… μ—λ¬ μƒν™© μ μ ν• μ²λ¦¬
- β… κΈ°μ΅΄ κ³„μ • κ΄€λ¦¬ κΈ°λ¥κ³Ό μ™„μ „ ν†µν•©
- β… μ‹κ°„ μ²λ¦¬ μ„μΈ μ‹κ°„ ν†µμΌ

#### λ³΄μ• μ”κµ¬μ‚¬ν•­ (100% λ‹¬μ„±)
- β… ν† ν° μ•”νΈν™” μ €μ¥ (Fernet)
- β… ν™κ²½λ³€μ λ³΄μ• κ΄€λ¦¬
- β… μ…λ ¥ κ²€μ¦ κ°•ν™”
- β… JWT λ¬΄κ²°μ„± κ²€μ¦

## λ‹¤μ λ‹¨κ³„ ν• μΌ λ©λ΅

### π― 3λ‹¨κ³„: Graph API μ—°λ™ (μ°μ„ μμ„: λ†’μ)

#### Phase 1: API ν΄λΌμ΄μ–ΈνΈ κΈ°λ° κµ¬μ΅° μ„¤κ³„ (μμƒ μ†μ”: 2μΌ)
- [ ] κΈ°μ΅΄ `GraphApiClientPort` μΈν„°νμ΄μ¤ ν™•μ¥
- [ ] λ©”μΌ κ΄€λ ¨ μ—”ν‹°ν‹° μ„¤κ³„
  - [ ] Mail μ—”ν‹°ν‹° ν™•μ¥
  - [ ] Attachment μ—”ν‹°ν‹°
  - [ ] MailFolder μ—”ν‹°ν‹°
- [ ] λ©”μΌ μ²λ¦¬ μ μ¦μΌ€μ΄μ¤ μ„¤κ³„
- [ ] API μ‘λ‹µ λ°μ΄ν„° λ¨λΈλ§

#### Phase 2: Graph API ν΄λΌμ΄μ–ΈνΈ κµ¬ν„ (μμƒ μ†μ”: 3μΌ)
- [ ] μΈμ¦λ HTTP ν΄λΌμ΄μ–ΈνΈ κµ¬ν„
- [ ] λ©”μΌ μ΅°ν API μ—°λ™
  - [ ] λ°›μ€νΈμ§€ν•¨ μ΅°ν
  - [ ] λ©”μΌ μƒμ„Έ μ΅°ν
  - [ ] μ²¨λ¶€νμΌ λ‹¤μ΄λ΅λ“
- [ ] λ©”μΌ λ°μ†΅ API μ—°λ™
- [ ] λ©”μΌ κ΄€λ¦¬ API μ—°λ™ (μ½μ μ²λ¦¬, μ‚­μ  λ“±)

#### Phase 3: λ©”μΌ μ²λ¦¬ μ μ¦μΌ€μ΄μ¤ κµ¬ν„ (μμƒ μ†μ”: 3μΌ)
- [ ] λ©”μΌ λ™κΈ°ν™” μ μ¦μΌ€μ΄μ¤
- [ ] λ©”μΌ κ²€μƒ‰ μ μ¦μΌ€μ΄μ¤
- [ ] λ©”μΌ λ°μ†΅ μ μ¦μΌ€μ΄μ¤
- [ ] λ©”μΌ κ΄€λ¦¬ μ μ¦μΌ€μ΄μ¤

#### Phase 4: CLI λ©”μΌ λ…λ Ήμ–΄ κµ¬ν„ (μμƒ μ†μ”: 2μΌ)
- [ ] mail λ…λ Ήμ–΄ κ·Έλ£Ή μƒμ„±
- [ ] list λ…λ Ήμ–΄ (λ©”μΌ λ©λ΅ μ΅°ν)
- [ ] read λ…λ Ήμ–΄ (λ©”μΌ μƒμ„Έ μ΅°ν)
- [ ] send λ…λ Ήμ–΄ (λ©”μΌ λ°μ†΅)
- [ ] sync λ…λ Ήμ–΄ (λ©”μΌ λ™κΈ°ν™”)

#### Phase 5: ν†µν•© ν…μ¤νΈ λ° μµμ ν™” (μμƒ μ†μ”: 2μΌ)
- [ ] μ‹¤μ  Graph API μ—°λ™ ν…μ¤νΈ
- [ ] λ€μ©λ‰ λ©”μΌ μ²λ¦¬ ν…μ¤νΈ
- [ ] μ„±λ¥ μµμ ν™”
- [ ] μ—λ¬ μ²λ¦¬ κ°μ„ 

**3λ‹¨κ³„ μμƒ μ΄ μ†μ” μ‹κ°„**: 12μΌ

### π“‹ 4λ‹¨κ³„: REST API μ„λ²„ ν™•μ¥ (μ°μ„ μμ„: μ¤‘κ°„)
- [ ] κΈ°μ΅΄ FastAPI μ›Ή μ„λ²„ ν™•μ¥
- [ ] λ©”μΌ κ΄€λ ¨ API μ—”λ“ν¬μΈνΈ μ¶”κ°€
- [ ] μΈμ¦ λ―Έλ“¤μ›¨μ–΄ κ°•ν™”
- [ ] API λ¬Έμ„ν™” μ™„μ„±
- [ ] μ—λ¬ μ²λ¦¬ ν‘μ¤€ν™”

### π“‹ 5λ‹¨κ³„: κ³ κΈ‰ κΈ°λ¥ (μ°μ„ μμ„: λ‚®μ)
- [ ] λ©”μΌ μλ™ λ¶„λ¥ κΈ°λ¥
- [ ] μ¤μΌ€μ¤„λ§ κΈ°λ¥ (μ •κΈ° λ™κΈ°ν™”)
- [ ] λ¨λ‹ν„°λ§ λ° μ•λ¦Ό
- [ ] μ„±λ¥ μµμ ν™” λ° μΊμ‹±

## κΈ°μ  μ¤νƒ ν„ν™©

### μ™„μ „ κµ¬ν„λ κΈ°μ  μ¤νƒ
- **λ°±μ—”λ“**: Python 3.11+, FastAPI, SQLAlchemy 2.0
- **λ°μ΄ν„°λ² μ΄μ¤**: SQLite (κ°λ°), PostgreSQL (ν”„λ΅λ•μ… μ¤€λΉ„)
- **μ•”νΈν™”**: cryptography (Fernet)
- **CLI**: Typer, Rich
- **HTTP ν΄λΌμ΄μ–ΈνΈ**: httpx
- **μ‹κ°„ μ²λ¦¬**: KST (UTC+9) ν†µμΌ
- **μΈμ¦**: OAuth 2.0 (Authorization Code Flow, Device Code Flow)

### λ‹¤μ λ‹¨κ³„ μ¶”κ°€ μμ •
- **λ©”μΌ μ²λ¦¬**: Microsoft Graph API
- **λ°μ΄ν„° μ²λ¦¬**: pandas (λ©”μΌ λ¶„μ„μ©)
- **μ¤μΌ€μ¤„λ§**: APScheduler
- **λ¨λ‹ν„°λ§**: λ΅κΉ… μ‹μ¤ν… κ°•ν™”

## μ„ν— μ”μ† λ° λ€μ‘ κ³„ν

### β οΈ 3λ‹¨κ³„ μμƒ μ„ν— μ”μ†
1. **Graph API νΈμ¶ μ ν•**
   - λ€μ‘: μ”μ²­ μ ν• μ¤€μ λ° μ¬μ‹λ„ λ΅μ§
   - λ°±μ—… κ³„ν: λ°°μΉ μ²λ¦¬ λ° μΊμ‹± μ μ©

2. **λ€μ©λ‰ λ©”μΌ μ²λ¦¬**
   - λ€μ‘: νμ΄μ§• λ° μ¤νΈλ¦¬λ° μ²λ¦¬
   - λ°±μ—… κ³„ν: λΉ„λ™κΈ° μ²λ¦¬ λ° ν μ‹μ¤ν…

3. **API μ‘λ‹µ ν•μ‹ λ³€κ²½**
   - λ€μ‘: λ²„μ „ κ΄€λ¦¬ λ° νΈν™μ„± μ μ§€
   - λ°±μ—… κ³„ν: μ‘λ‹µ κ²€μ¦ λ° μ—λ¬ μ²λ¦¬

## ν’μ§ κ΄€λ¦¬ ν„ν™©

### μ½”λ“ ν’μ§ (λ‹¬μ„±λ¥ : 95%)
- β… ν΄λ¦° μ•„ν‚¤ν…μ² μ›μΉ™ μ¤€μ
- β… ν¬νΈ/μ–΄λ‘ν„° ν¨ν„΄ μΌκ΄€μ„±
- β… νƒ€μ… ννΈ μ™„μ „μ„±
- β… μ—λ¬ μ²λ¦¬ ν‘μ¤€ν™”
- π”„ λ‹¨μ„ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ ν™•λ€ ν•„μ”

### λ³΄μ• μ²΄ν¬λ¦¬μ¤νΈ (λ‹¬μ„±λ¥ : 100%)
- β… ν† ν° μ•”νΈν™” μ €μ¥
- β… ν™κ²½λ³€μ λ³΄μ• κ΄€λ¦¬
- β… μ…λ ¥ κ²€μ¦ κ°•ν™”
- β… JWT λ¬΄κ²°μ„± κ²€μ¦
- β… λ³΄μ• μ·¨μ•½μ  μ—†μ

### μ‚¬μ©μ κ²½ν— (λ‹¬μ„±λ¥ : 95%)
- β… CLI λ…λ Ήμ–΄ μ§κ΄€μ„±
- β… μ—λ¬ λ©”μ‹μ§€ λ…ν™•μ„±
- β… μ§„ν–‰ μƒν™© μ‹κ°ν™”
- β… λ„μ›€λ§ μ™„μ„±λ„
- β… μ„±λ¥ μµμ ν™”

## λ§μΌμ¤ν†¤ λ° μ„±κ³Ό

### 2λ‹¨κ³„ μ™„λ£ μ„±κ³Ό (2025-05-26)
- **κΈ°κ°„**: ν”„λ΅μ νΈ μ‹μ‘ ~ 2025-05-26
- **μ£Όμ” μ„±κ³Ό**:
  - OAuth 2.0 μΈμ¦ μ‹μ¤ν… μ™„μ „ κµ¬ν„
  - μ‹κ°„ μ²λ¦¬ μ„μΈ μ‹κ°„ ν†µμΌ
  - CLI μΈν„°νμ΄μ¤ μ™„μ„±
  - μ›Ή μΈν„°νμ΄μ¤ κµ¬ν„
  - λ³΄μ• κ°•ν™” (ν† ν° μ•”νΈν™”)

### λ‹¤μ λ§μΌμ¤ν†¤ λ©ν‘
- **3λ‹¨κ³„ λ©ν‘ (2025-06-15)**: Graph API μ—°λ™ μ™„λ£
- **4λ‹¨κ³„ λ©ν‘ (2025-07-15)**: REST API μ„λ²„ μ™„μ„±
- **5λ‹¨κ³„ λ©ν‘ (2025-08-15)**: κ³ κΈ‰ κΈ°λ¥ κµ¬ν„

## ν•™μµ λ° κ°μ„  μ‚¬ν•­

### 2λ‹¨κ³„μ—μ„ λ°°μ΄ μ 
- OAuth 2.0 ν‘μ¤€ κµ¬ν„μ λ³µμ΅μ„±κ³Ό μ¤‘μ”μ„±
- JWT μ‹κ°„ μ²λ¦¬μ μ •ν™•μ„± ν•„μ”μ„±
- μ‚¬μ©μ μΈν„°νμ΄μ¤μ μ§κ΄€μ„± μ¤‘μ”μ„±
- λ³΄μ•κ³Ό μ‚¬μ©μ„±μ κ· ν•

### 3λ‹¨κ³„ μ μ© κ³„ν
- API νΈμ¶ μµμ ν™” λ° μ ν• μ¤€μ
- λ€μ©λ‰ λ°μ΄ν„° μ²λ¦¬ μ „λµ
- μ‚¬μ©μ κ²½ν— μ§€μ†μ  κ°μ„ 
- μ„±λ¥ λ¨λ‹ν„°λ§ κ°•ν™”

## ν„μ¬ μ‹μ¤ν… μƒνƒ μ”μ•½

### π‰ μ£Όμ” μ„±μ·¨
1. **μ™„μ „ν• OAuth 2.0 μΈμ¦ μ‹μ¤ν…** - μ—…κ³„ ν‘μ¤€ μ¤€μ
2. **μ‹κ°„ μ²λ¦¬ ν†µμΌ** - μ‚¬μ©μ μΉν™”μ  μ‹κ°„ ν‘μ‹
3. **λ³΄μ• κ°•ν™”** - ν† ν° μ•”νΈν™” λ° λ¬΄κ²°μ„± κ²€μ¦
4. **CLI μ™„μ„±λ„** - ν’λ¶€ν• λ…λ Ήμ–΄μ™€ μ§κ΄€μ  μΈν„°νμ΄μ¤
5. **μ›Ή μΈν„°νμ΄μ¤** - λΈλΌμ°μ € κΈ°λ° μΈμ¦ μ§€μ›

### π“ μ „μ²΄ ν”„λ΅μ νΈ μ§„ν–‰λ¥ : 40% (2/5 λ‹¨κ³„ μ™„λ£)

OAuth 2.0 μΈμ¦ μ‹μ¤ν…μ΄ μ™„μ „ν κµ¬ν„λμ–΄ Microsoft Graph API μ—°λ™μ„ μ„ν• κ²¬κ³ ν• κΈ°λ°μ΄ λ§λ ¨λμ—μµλ‹λ‹¤. λ‹¤μ λ‹¨κ³„μΈ Graph API μ—°λ™μ„ ν†µν•΄ μ‹¤μ  λ©”μΌ μ²λ¦¬ κΈ°λ¥μ„ κµ¬ν„ν•  μ¤€λΉ„κ°€ μ™„λ£λμ—μµλ‹λ‹¤.
